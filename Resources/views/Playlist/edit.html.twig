{% extends  "InnovaMediaResourceBundle::layout.html.twig" %}
{% block breadcrumb %}
    {{ parent() }}
{% endblock %}

{% macro playlist_region_prototype(playlistRegion) %}
    <tr>
        <td class="playlist_region_widget_ordering">
            <label></label>
            <!-- hidden widget -->
            {{ form_widget(playlistRegion.ordering) }}
        </td>
        <td class="playlist_region_widget_region">{{ form_widget(playlistRegion.region) }}</td>

        <td class="playlist_region_widget_delete text-right">
            <button role="button" type="button" onclick="removeRegionPlaylistRow(this)" class="btn btn-danger fa fa-trash"></button>
        </td>
    </tr>
{% endmacro %}

{% block media_resource_content %}

    {{ form_start(form) }}
    <!-- PANEL HEADER -->
    <div class="panel-heading">
        <div class="row">
            <div class="col-md-8">
                <h3 class="panel-title"> {{_resource.resourceNode.name}}: {{'playlist_edit_title' | trans({}, 'resource_form')}} </h3>  
            </div>
            <div class="col-md-4 text-right">                          
                <a href="{{path('innova_playlists', {'id':_resource.id})}}" style="line-height: 1;" class="btn btn-info">{{'playlist_return_to_list' | trans({}, 'resource_form')}}</a>
                <button type="button" role="button" class="btn btn-primary fa fa-play" id="play-button" disabled onclick="playlistPreListen();"></button>
                {{ form_widget(form.save) }}     
            </div>
        </div>
    </div>
    <!-- PANEL BODY -->
    <div class="panel-body playlist-add-container">       
        <!-- errors row -->
        <div class="row">
            <div class="col-md-12">
                {{ form_errors(form) }}
            </div>
        </div>     
        <!-- PLAYLIST NAME ROW -->
        <div class="row">
            <div class="col-md-2">
                <label>{{'media_resource_playlist_title_field_label' | trans({}, 'resource_form')}}</label>
            </div>
            <div class="col-md-10">
                {{ form_errors(form.name) }}
                {{ form_widget(form.name) }}                
            </div>
        </div>
        <hr/>
        <!-- PLAYLIST SEGMENTS / ORDER ROW -->
        {% if _resource.regions | length > 0 %}
            <div class="row">  
                <div class="col-md-12">
                    <table class="table table-striped collection" data-prototype="{{ _self.playlist_region_prototype(form.playlistRegions.vars.prototype)|e }}">
                        <thead>
                            <tr>
                                <th>{{'media_resource_playlist_playlistRegions_region' | trans({}, 'resource_form')}}</th>
                                <th>{{'media_resource_playlist_playlistRegions_order' | trans({}, 'resource_form')}}</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for playslitRegion in form.playlistRegions %}
                                {{ _self.playlist_region_prototype(playslitRegion, form) }}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <hr/>
            <!-- ADD ELEMENT ROW -->
            <div class="row">
                <div class="col-md-12 text-right">
                    <button type="button" role="button" class="btn btn-default add-collection">{{'media_resource_playlist_add_element' | trans({}, 'resource_form')}}</button>
                </div>
            </div>
            <audio id="aplayer" src="{{asset('')}}{{audioUrl}}"></audio>
        {% else %}
            <div class="row">
                <div class="col-md-12 center-text">
                    <h4>{{'playlist_no_segment' | trans({}, 'resource_form')}}</h4>
                </div>
            </div>
        {% endif %}
    </div>

    {{ form_end(form) }}
{% endblock %}

{% block javascripts  %}
    {{parent()}}
    {% javascripts '@InnovaMediaResourceBundle/Resources/public/js/playlist_add.js'%}
    <script src="{{ asset_url }}"></script>
    {% endjavascripts %}
{% endblock %} 

